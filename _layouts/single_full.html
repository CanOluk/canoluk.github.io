---
layout: default
---
{% include base_path %}

<div id="main" role="main">
  <article class="page h-entry page--fullwidth">
    <div class="page__inner-wrap">

      {% if page.title and page.hide_title != true %}
        <header><h1 class="page__title p-name">{{ page.title }}</h1></header>
      {% endif %}

      <!-- Two-column wrapper: content (left) + TOC (right) -->
      <div class="page__two-col">
        <!-- LEFT: main content -->
        <section class="page__content e-content">
          {{ content }}
        </section>

        <!-- RIGHT: sticky TOC -->
        {% if page.toc %}
        <aside class="sidebar__right{% if page.toc_sticky %} sticky{% endif %}" aria-label="On this page">
          <nav class="toc" id="toc">
            {% if page.toc_label and page.toc_label != false %}
              <h4 class="nav__title">{{ page.toc_label }}</h4>
            {% endif %}
            <ul id="toc-list"></ul>
          </nav>
        </aside>
        {% endif %}
      </div>

      {% if page.share %}{% include social-share.html %}{% endif %}
      {% if site.comments.provider and page.comments %}{% include comments.html %}{% endif %}
    </div>
  </article>
</div>

{% if page.toc %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const content = document.querySelector('section.page__content');
  const list = document.getElementById('toc-list');
  if (!content || !list) return;

  /* Collect H2/H3/H4 headings from the rendered HTML */
  const headings = content.querySelectorAll('h2, h3, h4');
  if (!headings.length) return;

  const slug = s => s.toLowerCase().trim()
    .replace(/[^\w\s-]/g, '')
    .replace(/\s+/g, '-')
    .replace(/-+/g, '-');

  let lastH2 = null, lastH3 = null;

  headings.forEach(h => {
    if (!h.id) h.id = slug(h.textContent);

    const a = document.createElement('a');
    a.href = '#' + h.id;

    /* Prefer a custom label if present:
       1) data-toc-label attribute (Markdown: {data-toc-label="Label"})
       2) <span class="toc-label">Label</span> inside the heading
       3) Fallback: text up to the first colon, else full text */
    const label =
      h.getAttribute('data-toc-label') ||
      (h.querySelector('.toc-label') ? h.querySelector('.toc-label').textContent : null) ||
      (function () {
        const t = h.textContent.trim();
        const i = t.indexOf(':');
        return i > -1 ? t.slice(0, i) : t;
      })();

    a.textContent = label;

    if (h.tagName === 'H2') {
      const li = document.createElement('li');
      li.className = 'toc-h2';
      li.appendChild(a);
      list.appendChild(li);
      lastH2 = li; lastH3 = null;
    } else if (h.tagName === 'H3') {
      const sub = lastH2?.querySelector('ul') || document.createElement('ul');
      if (!sub.parentElement && lastH2) { sub.className = 'toc-sub'; lastH2.appendChild(sub); }
      const li = document.createElement('li');
      li.className = 'toc-h3';
      li.appendChild(a);
      (lastH2 ? sub : list).appendChild(li);
      lastH3 = li;
    } else {
      /* H4 */
      const sub2 = lastH3?.querySelector('ul') || document.createElement('ul');
      if (!sub2.parentElement && lastH3) { sub2.className = 'toc-sub'; lastH3.appendChild(sub2); }
      const li = document.createElement('li');
      li.className = 'toc-h4';
      li.appendChild(a);
      (lastH3 ? sub2 : list).appendChild(li);
    }
  });
});
</script>
{% endif %}
