---
layout: default
---
{% include base_path %}

<div id="main" role="main">
  <article class="page h-entry page--fullwidth">
    <div class="page__inner-wrap">
      {% if page.title %}
        <header><h1 class="page__title p-name">{{ page.title }}</h1></header>
      {% endif %}

      <section class="page__content e-content">

        {% if page.toc %}
        <!-- In-page TOC (no includes needed) -->
        <div id="toc" class="toc-container {% if page.toc_sticky %}sticky{% endif %}">
          <h4>{{ page.toc_label | default: "On this page" }}</h4>
          <nav aria-label="Table of contents">
            <ul id="toc-list"></ul>
          </nav>
        </div>
        {% endif %}

        {{ content }}
      </section>

      {% if page.share %}{% include social-share.html %}{% endif %}
      {% if site.comments.provider and page.comments %}{% include comments.html %}{% endif %}
    </div>
  </article>
</div>

{% if page.toc %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const content = document.querySelector('article.page .page__content');
  if (!content) return;

  const headings = content.querySelectorAll('h2, h3'); // add h4 if needed
  const ul = document.getElementById('toc-list');
  if (!ul || headings.length === 0) return;

  const slug = s => s.toLowerCase().trim()
    .replace(/[^\w\s-]/g, '')
    .replace(/\s+/g, '-')
    .replace(/-+/g, '-');

  let lastH2Li = null;

  headings.forEach(h => {
    if (!h.id) h.id = slug(h.textContent);

    const a = document.createElement('a');
    a.href = '#' + h.id;
    a.textContent = h.textContent;

    if (h.tagName === 'H2') {
      const li = document.createElement('li');
      li.className = 'toc-h2';
      li.appendChild(a);
      ul.appendChild(li);
      lastH2Li = li;
    } else { // H3 branch
      const sub = lastH2Li?.querySelector('ul') || document.createElement('ul');
      if (!sub.parentElement) {
        sub.className = 'toc-sub';
        lastH2Li?.appendChild(sub);
      }
      const subLi = document.createElement('li');
      subLi.appendChild(a);
      sub.appendChild(subLi);
    }
  });
});
</script>
{% endif %}
